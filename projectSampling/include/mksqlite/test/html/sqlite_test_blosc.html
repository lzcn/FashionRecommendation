
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>sqlite_test_blosc</title><meta name="generator" content="MATLAB 7.13"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2016-04-18"><meta name="DC.source" content="sqlite_test_blosc.m"><style type="text/css">

body {
  background-color: white;
  margin:10px;
}

h1 {
  color: #990000; 
  font-size: x-large;
}

h2 {
  color: #990000;
  font-size: medium;
}

/* Make the text shrink to fit narrow windows, but not stretch too far in 
wide windows. */ 
p,h1,h2,div.content div {
  max-width: 600px;
  /* Hack for IE6 */
  width: auto !important; width: 600px;
}

pre.codeinput {
  background: #EEEEEE;
  padding: 10px;
}
@media print {
  pre.codeinput {word-wrap:break-word; width:100%;}
} 

span.keyword {color: #0000FF}
span.comment {color: #228B22}
span.string {color: #A020F0}
span.untermstring {color: #B20000}
span.syscmd {color: #B28C00}

pre.codeoutput {
  color: #666666;
  padding: 10px;
}

pre.error {
  color: red;
}

p.footer {
  text-align: right;
  font-size: xx-small;
  font-weight: lighter;
  font-style: italic;
  color: gray;
}

  </style></head><body><div class="content"><pre class="codeinput"><span class="keyword">function</span> sqlite_test_blosc

    clear <span class="string">all</span>
    close <span class="string">all</span>
    clc
    dummy = mksqlite(<span class="string">'version mex'</span>);
    fprintf( <span class="string">'\n\n'</span> );

    database = <span class="string">'demo.db'</span>;

    <span class="comment">% delete existing on-disc database if any</span>
    <span class="keyword">if</span> exist( database, <span class="string">'file'</span> )
        delete( database );
    <span class="keyword">end</span>

    <span class="comment">% create a new database file</span>
    mksqlite( <span class="string">'open'</span>, database );

    <span class="comment">% create table</span>
    mksqlite( [<span class="string">'CREATE TABLE demo '</span>   , <span class="keyword">...</span>
               <span class="string">' ( id PRIMARY KEY, '</span>  , <span class="keyword">...</span>
               <span class="string">'   type, '</span>            , <span class="keyword">...</span><span class="comment">  % indicating which compressor was used</span>
               <span class="string">'   data, '</span>            , <span class="keyword">...</span><span class="comment">  % packed random data</span>
               <span class="string">'   pack_ratio, '</span>      , <span class="keyword">...</span><span class="comment">  % compression ratio</span>
               <span class="string">'   pack_time, '</span>       , <span class="keyword">...</span><span class="comment">  % compression time</span>
               <span class="string">'   unpack_time '</span>     , <span class="keyword">...</span><span class="comment">  % decompression time</span>
               <span class="string">' )'</span>] );

    compressors = { <span class="string">'lz4'</span>, <span class="string">'lz4hc'</span>, <span class="string">'blosclz'</span> };  <span class="comment">% lossless compressors</span>

    typed_blob_mode   = 2; <span class="comment">% Use typed BLOBs with compression feature</span>
    compression_level = 9; <span class="comment">% level, range from 0=off to 9=max</span>

    <span class="comment">% You're not limited in mixing compressed and uncompressed data in the data base!</span>
    mksqlite( <span class="string">'typedBLOBs'</span>, typed_blob_mode ); <span class="comment">% switch typed BLOBs mode</span>
    mksqlite( <span class="string">'compression_check'</span>, 1 ); <span class="comment">% set check for compressed data on</span>

    <span class="comment">% generating recordset</span>
    fprintf( <span class="string">'Please wait, while generating 500 entries...\n'</span> );
    <span class="keyword">for</span> n = 1:500

        data = cumsum( randn( 10000, 1) );  <span class="comment">% some random data</span>

        <span class="comment">% set randomly one compression</span>
        type = randi(size(compressors)-1) + 1;
        compressor = compressors{type};
        mksqlite( <span class="string">'compression'</span>, compressor, compression_level );

        <span class="comment">% insert random data</span>
        mksqlite( [<span class="string">'INSERT INTO demo '</span>, <span class="keyword">...</span>
                   <span class="string">' (id, type, data) '</span>, <span class="keyword">...</span>
                   <span class="string">' VALUES (?,?,?)'</span>], <span class="keyword">...</span>
                   n, type, data );

        <span class="comment">% note that BDC...() SQL user functions depend on current</span>
        <span class="comment">% compression settings!</span>
        mksqlite( [<span class="string">'UPDATE demo SET '</span>, <span class="keyword">...</span>
                   <span class="string">'  pack_time   = BDCPackTime(data), '</span>   , <span class="keyword">...</span>
                   <span class="string">'  unpack_time = BDCUnpackTime(data), '</span> , <span class="keyword">...</span>
                   <span class="string">'  pack_ratio  = BDCRatio(data) '</span>   , <span class="keyword">...</span>
                   <span class="string">' WHERE id = ?'</span>], n );

        <span class="comment">% Display progress state</span>
        <span class="keyword">if</span> n &gt; 1
            fprintf( <span class="string">'%c'</span>, ones(3,1)*8 );
        <span class="keyword">end</span>

        fprintf( <span class="string">'%03d'</span>, n );
    <span class="keyword">end</span>

    fprintf( <span class="string">'\n\n\n'</span> );


    <span class="comment">% display some statistics about blosc compressors</span>
    <span class="keyword">for</span> i = 1:3
        fprintf( <span class="string">'Statistics for %s with max. compression rate:\n'</span>, compressors{i} );
        mksqlite( [<span class="string">'SELECT '</span>, <span class="keyword">...</span>
                   <span class="string">'  MIN(pack_time),   AVG(pack_time),   MAX(pack_time), '</span>, <span class="keyword">...</span>
                   <span class="string">'  MIN(unpack_time), AVG(unpack_time), MAX(unpack_time), '</span>, <span class="keyword">...</span>
                   <span class="string">'  MIN(pack_ratio),  AVG(pack_ratio),  MAX(pack_ratio) '</span>, <span class="keyword">...</span>
                   <span class="string">'  FROM demo WHERE type = ?'</span>], i )
    <span class="keyword">end</span>

    <span class="comment">%  close database</span>
    mksqlite( 0, <span class="string">'close'</span> );
</pre><pre class="codeoutput">mksqlite Version 2.2 build: 109, ein MATLAB Interface zu SQLite
(c) 2008-2016 by Martin Kortmann &lt;mail@kortmann.de&gt;
                 Andreas Martin  &lt;andimartin@users.sourceforge.net&gt;
basierend auf SQLite Version 3.10.2 - http://www.sqlite.org
mksqlite verwendet darueber hinaus:
 - DEELX perl kompatible regex engine Version 1.3 (Sswater@gmail.com)
 - BLOSC/LZ4 1.3.0-rc3.dev zur Datenkompression (Francesc Alted / Yann Collett) 
 - MD5 Message-Digest Algorithm (RFC 1321) Implementierung von Alexander Peslyak
   
Platform: PCWIN64, little endian



Please wait, while generating 500 entries...
500


Statistics for lz4 with max. compression rate:

ans = 

      MIN_pack_time_: 6.510618914035149e-005
      AVG_pack_time_: 1.862734724779080e-004
      MAX_pack_time_: 2.715690643526614e-004
    MIN_unpack_time_: 2.404823317192495e-005
    AVG_unpack_time_: 7.046567755992993e-005
    MAX_unpack_time_: 8.798133785603568e-005
     MIN_pack_ratio_: 0.799700000000000
     AVG_pack_ratio_: 0.839691081871345
     MAX_pack_ratio_: 0.878587500000000

Statistics for lz4hc with max. compression rate:

ans = 

      MIN_pack_time_: 0.001088329157938
      AVG_pack_time_: 0.003446761327397
      MAX_pack_time_: 0.004889709529380
    MIN_unpack_time_: 2.258187669212930e-005
    AVG_unpack_time_: 6.241928437802768e-005
    MAX_unpack_time_: 7.507740883738734e-005
     MIN_pack_ratio_: 0.783575000000000
     AVG_pack_ratio_: 0.827479263005780
     MAX_pack_ratio_: 0.871287500000000

Statistics for blosclz with max. compression rate:

ans = 

      MIN_pack_time_: 3.660023685370106e-004
      AVG_pack_time_: 0.001059351714759
      MAX_pack_time_: 0.001190680781292
    MIN_unpack_time_: 4.575029379338957e-005
    AVG_unpack_time_: 1.403001559736321e-004
    MAX_unpack_time_: 1.665780000621453e-004
     MIN_pack_ratio_: 0.787762500000000
     AVG_pack_ratio_: 0.837884615384615
     MAX_pack_ratio_: 0.870237500000000

</pre><p class="footer"><br>
      Published with MATLAB&reg; 7.13<br></p></div><!--
##### SOURCE BEGIN #####
function sqlite_test_blosc

    clear all
    close all
    clc
    dummy = mksqlite('version mex');
    fprintf( '\n\n' );
    
    database = 'demo.db';
    
    % delete existing on-disc database if any
    if exist( database, 'file' )
        delete( database );
    end

    % create a new database file
    mksqlite( 'open', database );

    % create table
    mksqlite( ['CREATE TABLE demo '   , ...
               ' ( id PRIMARY KEY, '  , ...
               '   type, '            , ...  % indicating which compressor was used
               '   data, '            , ...  % packed random data
               '   pack_ratio, '      , ...  % compression ratio
               '   pack_time, '       , ...  % compression time
               '   unpack_time '     , ...  % decompression time
               ' )'] );
             
    compressors = { 'lz4', 'lz4hc', 'blosclz' };  % lossless compressors

    typed_blob_mode   = 2; % Use typed BLOBs with compression feature
    compression_level = 9; % level, range from 0=off to 9=max

    % You're not limited in mixing compressed and uncompressed data in the data base!
    mksqlite( 'typedBLOBs', typed_blob_mode ); % switch typed BLOBs mode
    mksqlite( 'compression_check', 1 ); % set check for compressed data on

    % generating recordset
    fprintf( 'Please wait, while generating 500 entries...\n' );
    for n = 1:500

        data = cumsum( randn( 10000, 1) );  % some random data

        % set randomly one compression
        type = randi(size(compressors)-1) + 1;
        compressor = compressors{type};
        mksqlite( 'compression', compressor, compression_level ); 

        % insert random data
        mksqlite( ['INSERT INTO demo ', ...
                   ' (id, type, data) ', ...
                   ' VALUES (?,?,?)'], ...
                   n, type, data );

        % note that BDC...() SQL user functions depend on current
        % compression settings!
        mksqlite( ['UPDATE demo SET ', ...
                   '  pack_time   = BDCPackTime(data), '   , ...
                   '  unpack_time = BDCUnpackTime(data), ' , ...
                   '  pack_ratio  = BDCRatio(data) '   , ...
                   ' WHERE id = ?'], n );

        % Display progress state
        if n > 1
            fprintf( '%c', ones(3,1)*8 );
        end

        fprintf( '%03d', n );
    end
    
    fprintf( '\n\n\n' );
    
    
    % display some statistics about blosc compressors
    for i = 1:3
        fprintf( 'Statistics for %s with max. compression rate:\n', compressors{i} );
        mksqlite( ['SELECT ', ...
                   '  MIN(pack_time),   AVG(pack_time),   MAX(pack_time), ', ...
                   '  MIN(unpack_time), AVG(unpack_time), MAX(unpack_time), ', ...
                   '  MIN(pack_ratio),  AVG(pack_ratio),  MAX(pack_ratio) ', ...
                   '  FROM demo WHERE type = ?'], i )
    end

    %  close database
    mksqlite( 0, 'close' );

##### SOURCE END #####
--></body></html>