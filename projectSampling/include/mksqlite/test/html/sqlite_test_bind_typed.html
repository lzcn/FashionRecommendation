
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>sqlite_test_bind_typed</title><meta name="generator" content="MATLAB 7.13"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2016-04-18"><meta name="DC.source" content="sqlite_test_bind_typed.m"><style type="text/css">

body {
  background-color: white;
  margin:10px;
}

h1 {
  color: #990000; 
  font-size: x-large;
}

h2 {
  color: #990000;
  font-size: medium;
}

/* Make the text shrink to fit narrow windows, but not stretch too far in 
wide windows. */ 
p,h1,h2,div.content div {
  max-width: 600px;
  /* Hack for IE6 */
  width: auto !important; width: 600px;
}

pre.codeinput {
  background: #EEEEEE;
  padding: 10px;
}
@media print {
  pre.codeinput {word-wrap:break-word; width:100%;}
} 

span.keyword {color: #0000FF}
span.comment {color: #228B22}
span.string {color: #A020F0}
span.untermstring {color: #B20000}
span.syscmd {color: #B28C00}

pre.codeoutput {
  color: #666666;
  padding: 10px;
}

pre.error {
  color: red;
}

p.footer {
  text-align: right;
  font-size: xx-small;
  font-weight: lighter;
  font-style: italic;
  color: gray;
}

  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#3">Create an in-memory database</a></li><li><a href="#4">Take a screenshot (figure) as RGB-matrix...</a></li><li><a href="#5">Store using typed BLOB feature</a></li><li><a href="#6">Now read back values</a></li></ul></div><pre class="codeinput"><span class="keyword">function</span> sqlite_test_bind_typed
</pre><pre class="codeinput">    clear <span class="string">all</span>
    close <span class="string">all</span>
    clc
    dummy = mksqlite(<span class="string">'version mex'</span>);
    fprintf( <span class="string">'\n\n'</span> );
</pre><pre class="codeoutput">mksqlite Version 2.2 build: 109, ein MATLAB Interface zu SQLite
(c) 2008-2016 by Martin Kortmann &lt;mail@kortmann.de&gt;
                 Andreas Martin  &lt;andimartin@users.sourceforge.net&gt;
basierend auf SQLite Version 3.10.2 - http://www.sqlite.org
mksqlite verwendet darueber hinaus:
 - DEELX perl kompatible regex engine Version 1.3 (Sswater@gmail.com)
 - BLOSC/LZ4 1.3.0-rc3.dev zur Datenkompression (Francesc Alted / Yann Collett) 
 - MD5 Message-Digest Algorithm (RFC 1321) Implementierung von Alexander Peslyak
   
Platform: PCWIN64, little endian



</pre><h2>Create an in-memory database<a name="3"></a></h2><pre class="codeinput">    mksqlite( <span class="string">'open'</span>, <span class="string">':memory:'</span> );
    mksqlite( <span class="string">'param_wrapping'</span>, 0 );

    <span class="comment">% mksqlite stores numeric arrays always as an array of bytes (uint8),</span>
    <span class="comment">% since SQLite only supports native byte array (BLOB). When you fetch</span>
    <span class="comment">% a BLOB you will always get your result as byte array of type uint8.</span>
    <span class="comment">% With typed BLOBs mksqlite stores additionally informations (dimensions and</span>
    <span class="comment">% numeric type), so it can be returned in the same format as it was before.</span>
    <span class="comment">% No casting or reshaping will be necessary.</span>

    mksqlite( <span class="string">'typedBLOBs'</span>, 1 );

    <span class="comment">%          |First name |Last name    |City         |Random data</span>
    mydata = { <span class="keyword">...</span>
               <span class="string">'Gunther'</span>,  <span class="string">'Meyer'</span>,      <span class="string">'Munich'</span>,     []; <span class="keyword">...</span>
               <span class="string">'Holger'</span>,   <span class="string">'Michelmann'</span>, <span class="string">'Garbsen'</span>,    rand( 1, 10 ); <span class="keyword">...</span>
               <span class="string">'Knuth'</span>,    <span class="string">'Almeroth'</span>,   <span class="string">'Wehnsen'</span>,    <span class="string">'coworker'</span> <span class="keyword">...</span>
             };

    <span class="comment">% create table</span>
    mksqlite( <span class="string">'CREATE TABLE demo (Col_1, Col_2, Col_3, Data)'</span> );

    <span class="comment">% create records</span>
    <span class="comment">% uses MATLAB "cell expansion" for command</span>
    <span class="comment">% shortening: mydata{i,:} expands to 4 arguments</span>
    <span class="keyword">for</span> i = 1:size( mydata, 1 )
        mksqlite( <span class="string">'INSERT INTO demo VALUES (?,?,?,?)'</span>, mydata{i,:} );
    <span class="keyword">end</span>
</pre><h2>Take a screenshot (figure) as RGB-matrix...<a name="4"></a></h2><pre class="codeinput">    h = figure;
    set( h, <span class="string">'units'</span>, <span class="string">'normalized'</span>, <span class="string">'position'</span>, [0.5,0.5,0.2,0.2] );
    x = linspace( 0, 2*pi, 20 );
    plot( x, sin(x), <span class="string">'r-'</span>, <span class="string">'linewidth'</span>, 2 );
    legend <span class="string">on</span>
    F = getframe(h);
    delete(h);
    data = F.cdata;
</pre><h2>Store using typed BLOB feature<a name="5"></a></h2><pre class="codeinput">    mksqlite( <span class="string">'INSERT INTO demo (Data) VALUES (?)'</span>, data );

    <span class="keyword">try</span>
        <span class="comment">% enable advanced typed BLOBs. So now structures cell arrays</span>
        <span class="comment">% and complex numbers can be stored as BLOB in the database.</span>
        mksqlite( <span class="string">'typedBLOBs'</span>, 2 );
    <span class="keyword">catch</span>
        <span class="comment">% If your MATLAB version doesn't support streaming (serialization)</span>
        <span class="comment">% of variables, mksqlite will report an error. mksqlite uses mode 1</span>
        <span class="comment">% then. You can read the current mode with:</span>
        <span class="comment">%   mode = mksqlite( 'typedBLOBs' );</span>
        <span class="comment">% Discarding the fail, because this will be checked next...</span>
    <span class="keyword">end</span>

    <span class="comment">% If your MATLAB version doesn't support streaming, then skip writing</span>
    <span class="comment">% structures and complex numbers (nested variables)...</span>
    <span class="comment">% (mksqlite( 'typedBLOBs' ) will be 1 then)</span>
    <span class="keyword">if</span> mksqlite( <span class="string">'typedBLOBs'</span> ) == 2
        data_complex = struct;
        data_complex.String = <span class="string">'Name'</span>;
        data_complex.Complex = 3+4i;
        data_complex.Cell = { 1:10, <span class="string">'Text'</span>, 1+2i };

        mksqlite( <span class="string">'INSERT INTO demo (Data) VALUES (?)'</span>, data_complex );
    <span class="keyword">end</span>
</pre><h2>Now read back values<a name="6"></a></h2><pre class="codeinput">    clc
    fprintf( <span class="string">'Get BLOB with the original data types from the database...\n\n'</span> )

    query = mksqlite( <span class="string">'SELECT * FROM demo'</span> );

    fprintf( <span class="string">'---&gt; Empty array: '</span> ), <span class="keyword">...</span>
             query(1).Data

    fprintf( <span class="string">'---&gt; 10 random numbers between 0 and 1: '</span> ), <span class="keyword">...</span>
             query(2).Data

    fprintf( <span class="string">'---&gt; Text: '</span> ), <span class="keyword">...</span>
             query(3).Data

    fprintf(<span class="string">'---&gt; Image: (see figure) \n\n'</span>)

    <span class="comment">% Due to typed BLOBs the image data haven't to be reshaped or casted.</span>
    img = query(4).Data;

    h = image( img );
    axis <span class="string">off</span>
    set( gcf, <span class="string">'units'</span>, <span class="string">'normalized'</span>, <span class="string">'position'</span>, [0.5,0.5,0.2,0.2] );
    drawnow

    <span class="comment">% bring recent figure to top</span>
    <span class="keyword">try</span>
        warning( <span class="string">'off'</span>, <span class="string">'MATLAB:HandleGraphics:ObsoletedProperty:JavaFrame'</span> );
        jh = get( h, <span class="string">'JavaFrame'</span> );
        jh.fFigureClient.getWindow.setAlwaysOnTop( true );
        jh.fFigureClient.getWindow.setVisible( true );
    <span class="keyword">catch</span>
    <span class="keyword">end</span>

    <span class="comment">% if streaming is supported, fetch the nested variable</span>
    <span class="keyword">if</span> mksqlite( <span class="string">'typedBLOBs'</span> ) == 2
        fprintf( <span class="string">'---&gt; Nested variable: '</span> );
        query(5).Data
    <span class="keyword">else</span>
        fprintf( [<span class="string">'\nThis MATLAB version doesn''t support serialization.\n'</span>, <span class="keyword">...</span>
                  <span class="string">'The test of handling nested variables will be skipped.\n'</span>] );
    <span class="keyword">end</span>

    mksqlite( <span class="string">'close'</span> );
</pre><pre class="codeoutput">Get BLOB with the original data types from the database...

---&gt; Empty array: 
ans =

     []

---&gt; 10 random numbers between 0 and 1: 
ans =

  Columns 1 through 5

   0.849535217673572   0.442025428722857   0.441695929019839   0.747884995533928   0.162478711249925

  Columns 6 through 10

   0.085367892525948   0.090326779850008   0.588791243158930   0.303271448089238   0.668746928855276

---&gt; Text: 
ans =

coworker

---&gt; Image: (see figure) 

---&gt; Nested variable: 
ans = 

     String: 'Name'
    Complex: 3.000000000000000 + 4.000000000000000i
       Cell: {[1 2 3 4 5 6 7 8 9 10]  'Text'  [1.000000000000000 + 2.000000000000000i]}

</pre><img vspace="5" hspace="5" src="sqlite_test_bind_typed_01.jpg" alt=""> <p class="footer"><br>
      Published with MATLAB&reg; 7.13<br></p></div><!--
##### SOURCE BEGIN #####
function sqlite_test_bind_typed
  
    clear all
    close all
    clc
    dummy = mksqlite('version mex');
    fprintf( '\n\n' );
    

    %% Create an in-memory database
    mksqlite( 'open', ':memory:' );
    mksqlite( 'param_wrapping', 0 );

    % mksqlite stores numeric arrays always as an array of bytes (uint8),
    % since SQLite only supports native byte array (BLOB). When you fetch 
    % a BLOB you will always get your result as byte array of type uint8.
    % With typed BLOBs mksqlite stores additionally informations (dimensions and 
    % numeric type), so it can be returned in the same format as it was before. 
    % No casting or reshaping will be necessary.
    
    mksqlite( 'typedBLOBs', 1 ); 

    %          |First name |Last name    |City         |Random data
    mydata = { ...
               'Gunther',  'Meyer',      'Munich',     []; ...
               'Holger',   'Michelmann', 'Garbsen',    rand( 1, 10 ); ...
               'Knuth',    'Almeroth',   'Wehnsen',    'coworker' ...
             }; 

    % create table
    mksqlite( 'CREATE TABLE demo (Col_1, Col_2, Col_3, Data)' );

    % create records
    % uses MATLAB "cell expansion" for command 
    % shortening: mydata{i,:} expands to 4 arguments
    for i = 1:size( mydata, 1 )
        mksqlite( 'INSERT INTO demo VALUES (?,?,?,?)', mydata{i,:} );
    end

    %% Take a screenshot (figure) as RGB-matrix...
    h = figure;
    set( h, 'units', 'normalized', 'position', [0.5,0.5,0.2,0.2] );
    x = linspace( 0, 2*pi, 20 );
    plot( x, sin(x), 'r-', 'linewidth', 2 );
    legend on
    F = getframe(h);
    delete(h);
    data = F.cdata;

    %% Store using typed BLOB feature
    mksqlite( 'INSERT INTO demo (Data) VALUES (?)', data );

    try
        % enable advanced typed BLOBs. So now structures cell arrays 
        % and complex numbers can be stored as BLOB in the database.
        mksqlite( 'typedBLOBs', 2 );
    catch
        % If your MATLAB version doesn't support streaming (serialization)
        % of variables, mksqlite will report an error. mksqlite uses mode 1
        % then. You can read the current mode with:
        %   mode = mksqlite( 'typedBLOBs' );
        % Discarding the fail, because this will be checked next...
    end

    % If your MATLAB version doesn't support streaming, then skip writing
    % structures and complex numbers (nested variables)...
    % (mksqlite( 'typedBLOBs' ) will be 1 then)
    if mksqlite( 'typedBLOBs' ) == 2
        data_complex = struct;
        data_complex.String = 'Name';
        data_complex.Complex = 3+4i;
        data_complex.Cell = { 1:10, 'Text', 1+2i };

        mksqlite( 'INSERT INTO demo (Data) VALUES (?)', data_complex );
    end 


    %% Now read back values
    clc
    fprintf( 'Get BLOB with the original data types from the database...\n\n' )

    query = mksqlite( 'SELECT * FROM demo' );

    fprintf( 'REPLACE_WITH_DASH_DASH-> Empty array: ' ), ...
             query(1).Data

    fprintf( 'REPLACE_WITH_DASH_DASH-> 10 random numbers between 0 and 1: ' ), ...
             query(2).Data

    fprintf( 'REPLACE_WITH_DASH_DASH-> Text: ' ), ...
             query(3).Data

    fprintf('REPLACE_WITH_DASH_DASH-> Image: (see figure) \n\n')

    % Due to typed BLOBs the image data haven't to be reshaped or casted.
    img = query(4).Data;

    h = image( img );
    axis off
    set( gcf, 'units', 'normalized', 'position', [0.5,0.5,0.2,0.2] );
    drawnow

    % bring recent figure to top
    try
        warning( 'off', 'MATLAB:HandleGraphics:ObsoletedProperty:JavaFrame' );
        jh = get( h, 'JavaFrame' );
        jh.fFigureClient.getWindow.setAlwaysOnTop( true );
        jh.fFigureClient.getWindow.setVisible( true );
    catch
    end

    % if streaming is supported, fetch the nested variable
    if mksqlite( 'typedBLOBs' ) == 2
        fprintf( 'REPLACE_WITH_DASH_DASH-> Nested variable: ' );
        query(5).Data
    else
        fprintf( ['\nThis MATLAB version doesn''t support serialization.\n', ...
                  'The test of handling nested variables will be skipped.\n'] );
    end

    mksqlite( 'close' );

##### SOURCE END #####
--></body></html>